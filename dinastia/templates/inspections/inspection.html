{% extends '../base/base.html' %}


{% block header %}
    Осмотр {{ inspection_type }}
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.min.js"
            integrity="sha256-/7FLTdzP6CfC1VBAj/rsp3Rinuuu9leMRGd354hvk0k=" crossorigin="anonymous"></script>
    <script>

        $(document).ready(function ($) {

            $(".datepicker").datepicker({
                language: "ru-RU",
                format: 'yyyy-mm-dd',
                days: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'],
                daysShort: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                daysMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
                monthsShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
                weekStart: 1,
                startView: 0,
                yearFirst: false,
                yearSuffix: ''
            });

            $('.fa-close').click(function () {
                let parent = this.parentNode;
                let file_id = parent.getAttribute('file_id');

                $.ajax({
                    url: "{% url 'inspection_file_delete' %}",
                    data: {
                        file_id: file_id
                    },
                    success: function (data) {
                        parent.remove();
                    }
                })
            })
        })


        {% if print %}
            window.open("{% url 'inspection_print' pk %}")
        {% endif %}
    </script>
{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.min.css"
          integrity="sha256-b88RdwbRJEzRx95nCuuva+hO5ExvXXnpX+78h8DjyOE=" crossorigin="anonymous"/>
{% endblock %}

{% block content %}
    {{ form.media }}
    <button class="button" onclick="document.location='{% url 'inspections_menu' %}'">Назад</button>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {% block patient %}
            <h3 style="color: red">{{ error }}</h3>
            <div class="row" style="justify-content: center">
                <h5>Пациент</h5>
                <div class="col">
                    <div class="text-field text-field_floating-2">
                        {{ form.surname }}
                        <label for="{{ form.surname.auto_id }}">{{ form.surname.label }}</label>
                    </div>
                </div>

                <div class="col">
                    <div class="text-field text-field_floating-2 col">
                        {{ form.name }}
                        <label for="{{ form.name.auto_id }}">{{ form.name.label }}</label>
                    </div>
                </div>


                <div class="col">
                    <div class="text-field text-field_floating-2 col">
                        {{ form.patronymic }}
                        <label for="{{ form.patronymic.auto_id }}">{{ form.patronymic.label }}</label>
                    </div>
                </div>

                <div class="col">
                    <div class="text-field text-field_floating-2 col">
                        {{ form.dob }}
                        <label for="{{ form.dob.auto_id }}">{{ form.dob.label }}</label>
                    </div>
                </div>
                <div class="col">
                    <div class="text-field text-field_floating-2 col">
                        {{ form.phone }}
                        <label for="{{ form.phone.auto_id }}">{{ form.phone.label }}</label>
                    </div>
                </div>
            </div>
        {% endblock %}

        <h5>{{ form.complaints.label }}</h5>
        {{ form.complaints }}

        <h5>{{ form.anamnesis.label }}</h5>
        {{ form.anamnesis }}

        <h5>{{ form.diagnosis.label }}</h5>
        {{ form.diagnosis }}

        <h5>{{ form.additionally.label }}</h5>
        {{ form.additionally }}

        <br>
        <p align="center">
            {{ form.files.label_tag }}
            {{ form.files }}
        </p>
        {% if files_list|length > 0 %}
            {% load static %}
            <h5>Загруженные файлы</h5>
            <ul class="files_ul" align="center">
                {% for file in files_list %}
                    <li file_id="{{ file.id }}">
                        <a href="{% static file.url %}" target="_blank">{{ file.filename }}</a>
                        <i class="fa fa-close fa-lg" style="color: red;cursor: pointer"></i>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
        <br>

        <p align="center">
            {{ form.print.label_tag }}
            {{ form.print }}
        </p>
        <br>
        <input align="center" class="button submit_button" type="submit" value="Сохранить">
    </form>

{% endblock %}